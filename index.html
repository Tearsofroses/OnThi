<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive MCQ Quiz</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <link rel="stylesheet" href="styles.css?v=1.0.1">
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- Google reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6LfFVyksAAAAAHRZbip60OZY6h19WSAwrKojXlf5"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Interactive MCQ Quiz</h1>
        </header>

        <!-- Input Section -->
        <div id="input-section" class="section">
            <h2>Setup Your Quiz</h2>
            
            <!-- Quiz Sessions -->
            <div id="sessions-section" class="saved-quizzes sessions-section">
                <h3>ğŸ“š My Quiz Sessions</h3>
                <div id="sessions-list" class="quiz-list sessions-container">
                    <p class="no-quizzes">No quiz sessions yet</p>
                </div>
            </div>
            
            <!-- Shared Quizzes -->
            <div id="shared-quizzes-section" class="saved-quizzes shared-section">
                <div class="section-header">
                    <h3>ğŸŒ Community Shared Quizzes</h3>
                    <button id="refresh-shared-btn" class="btn btn-small btn-secondary">ğŸ”„ Refresh</button>
                </div>
                <div class="course-filter-section">
                    <label for="course-filter">Filter by Course:</label>
                    <select id="course-filter" class="course-filter-dropdown">
                        <option value="all">All Courses</option>
                    </select>
                </div>
                <div id="shared-quizzes-list" class="quiz-list">
                    <p class="no-quizzes">Loading community quizzes...</p>
                </div>
                <p class="share-info">ğŸ’¡ Click "ğŸ“¤ Share to Community" to publish your quiz for everyone!<br>
                <small style="color: #666;">Other users need to click ğŸ”„ Refresh to see new quizzes</small></p>
            </div>
            
            <div class="format-guide">
                <h3>Supported Formats:</h3>
                <div class="format-example">
                    <div class="format-header">
                        <strong>ğŸ“ Format 1: Compact Format (with answer key)</strong>
                        <div class="format-buttons">
                            <button id="copy-prompt-btn" class="btn-copy-format" title="Copy AI prompt for generating quizzes">ğŸ¤– Copy AI Prompt</button>
                            <button id="copy-format-btn" class="btn-copy-format" title="Copy sample format">ğŸ“‹ Copy Sample</button>
                        </div>
                    </div>
                    <pre>1. (LO 1.1) Which of the following best describes the "Three-Schema Architecture"?

A. It separates the database into three physical files for redundancy.
B. It separates the user applications from the physical database to achieve data independence.
C. It divides users into three levels: Administrator, Designer, and End User.
D. It is a backup strategy involving three copies of data.

2. (LO 1.2) In the Relational Data Model, what is a "Relation" conceptually equivalent to?
A. A row in a file.
B. A pointer connecting two records.
C. A mathematical table of values using $R(X, Y, Z)$ notation.
D. A hierarchy of objects.</pre>
                    
                    <strong>Answer Key (at the end):</strong>
                    <pre>1B2C3A4B5C...</pre>
                    
                    <strong>ğŸ“ Format 2: Moodle/LMS HTML (includes answers!)</strong>
                    <p class="format-note" style="margin-top: 8px; margin-bottom: 8px;">
                        <strong>How to get the HTML:</strong>
                        <br>1. Open your Moodle quiz review page (with correct answers shown)
                        <br>2. Press <kbd>Ctrl+U</kbd> (Windows) or <kbd>Cmd+Option+U</kbd> (Mac) to view page source
                        <br>3. Press <kbd>Ctrl+A</kbd> to select all, then <kbd>Ctrl+C</kbd> to copy
                        <br>4. Paste the HTML here - it will automatically extract questions AND correct answers!
                    </p>
                    
                    <p class="format-note"><strong>ğŸ’¡ Note:</strong> LaTeX math notation like $\pi$, $\sigma$, $R(X,Y)$ is supported! Markdown formatting is also supported (**bold**, *italic*, `code`, [links](url)). HTML format automatically extracts correct answers from the page.</p>
                </div>
            </div>
            
            <p>Paste your MCQ questions and answer key below:</p>
            <div class="quiz-name-section">
                <label for="quiz-name-input">Quiz Name <span style="color: red;">*</span></label>
                <input type="text" id="quiz-name-input" placeholder="e.g., Database Management Final Exam" maxlength="100" required>
            </div>
            <div class="quiz-name-section">
                <label for="quiz-course-input">Course <span style="color: red;">*</span></label>
                <div class="course-input-group">
                    <input type="text" id="quiz-course-input" list="course-suggestions" placeholder="e.g., Software Engineering" maxlength="50" required>
                    <datalist id="course-suggestions"></datalist>
                </div>
            </div>
            <div class="quiz-name-section">
                <label for="quiz-timer-input">Time Limit (optional)</label>
                <div class="timer-input-group">
                    <input type="number" id="quiz-timer-input" placeholder="Minutes" min="1" max="999">
                    <span class="timer-hint">â±ï¸ Leave empty for no time limit</span>
                </div>
            </div>
            <textarea id="quiz-input" placeholder="Paste your questions here..."></textarea>
            
            <div class="input-actions">
                <button id="start-quiz-btn" class="btn btn-primary">Start Quiz</button>
                <button id="publish-quiz-btn" class="btn btn-success">ğŸ“¤ Share to Community</button>
            </div>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-section" class="section hidden quiz-with-chat">
            <div class="quiz-main-content">
                <div class="quiz-header">
                    <button id="return-to-main-btn" class="btn-return" title="Return to Main Page">â† Back</button>
                    <button id="show-chat-btn" class="btn-show-chat hidden" title="Show AI Chat">ğŸ’¬ Show AI Helper</button>
                    <div class="progress-bar">
                        <div id="progress" class="progress-fill"></div>
                    </div>
                    <div class="quiz-header-info">
                        <p class="question-counter">Question <span id="current-q">1</span> of <span id="total-q">0</span></p>
                        <p class="timer-display">â±ï¸ <span id="timer-display">0:00</span></p>
                        <p class="countdown-display hidden" id="countdown-display">â° Time Left: <span id="countdown-timer">--:--</span></p>
                    </div>
                </div>
            
            <div id="question-container">
                <h3 id="question-text"></h3>
                <div id="options-container" class="options"></div>
            </div>

            <div class="quiz-controls">
                <button id="prev-btn" class="btn btn-secondary" disabled>Previous</button>
                <button id="next-btn" class="btn btn-primary">Next</button>
                <button id="submit-btn" class="btn btn-success hidden">Submit Quiz</button>
            </div>
            </div>

            <!-- AI Chat Sidebar -->
            <div id="ai-chat-sidebar" class="ai-chat-sidebar">
                <div class="chat-header">
                    <h3>ğŸ’¬ AI Study Helper</h3>
                    <button id="chat-toggle-btn" class="chat-toggle-btn">Hide</button>
                </div>
                <div id="chat-status" class="chat-status">
                    âš™ï¸ Configure AI in settings to get help
                </div>
                <div id="chat-messages" class="chat-messages">
                    <div class="chat-message system">
                        ğŸ‘‹ Hi! I'm your AI study assistant. Ask me anything about the current question!
                    </div>
                </div>
                <div class="chat-quick-actions">
                    <button class="quick-action-btn" data-action="explain">ğŸ’¡ Explain</button>
                    <button class="quick-action-btn" data-action="hint">ğŸ¯ Give Hint</button>
                    <button class="quick-action-btn" data-action="breakdown">ğŸ” Break Down</button>
                    <button class="quick-action-btn" data-action="topic">ğŸ“– Topic</button>
                </div>
                <div class="chat-input-area">
                    <div class="chat-input-group">
                        <textarea id="chat-input" class="chat-input" placeholder="Ask a question..." rows="2"></textarea>
                        <button id="chat-send-btn" class="chat-send-btn">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Settings Modal -->
        <div id="ai-settings-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ğŸ¤– AI Assistant Settings</h2>
                    <div class="security-warning">
                        <strong>ğŸ”’ Security:</strong> Your API key is stored only in your browser's session (cleared when you close the browser). It is NEVER sent to our servers and only goes directly to your chosen AI provider.
                    </div>
                </div>
                <div class="form-group">
                    <label for="ai-provider-select">Choose AI Provider:</label>
                    <select id="ai-provider-select">
                        <option value="">-- Select Provider --</option>
                        <option value="openai">OpenAI (ChatGPT)</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="groq">Groq (Free)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ai-api-key-input">API Key:</label>
                    <input type="password" id="ai-api-key-input" class="api-key-input" placeholder="Paste your API key here...">
                    <small style="color: #666; margin-top: 5px; display: block;">
                        ğŸ”‘ Get your free API key from:
                        <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #667eea; font-weight: 600;">OpenAI</a> |
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #667eea; font-weight: 600;">Google AI Studio</a> |
                        <a href="https://console.groq.com/keys" target="_blank" style="color: #667eea; font-weight: 600;">Groq</a>
                    </small>
                    <button id="fetch-models-btn" class="btn btn-primary" style="margin-top: 10px; width: 100%;" disabled>
                        ğŸ”„ Fetch Available Models
                    </button>
                </div>
                <div class="form-group">
                    <label for="ai-model-select">Choose Model:</label>
                    <select id="ai-model-select" disabled>
                        <option value="">-- Fetch models first --</option>
                    </select>
                    <div id="model-loading" style="display: none; color: #667eea; margin-top: 5px;">
                        â³ Fetching models...
                    </div>
                    <small id="model-hint" style="color: #666; margin-top: 5px; display: block;">
                        ğŸ’¡ Enter API key and click "Fetch Available Models" to see your options
                    </small>
                </div>
                <div class="modal-actions">
                    <button id="ai-settings-clear-btn" class="btn btn-danger">Clear</button>
                    <button id="ai-settings-cancel-btn" class="btn btn-secondary">Cancel</button>
                    <button id="ai-settings-save-btn" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>

        <!-- AI Settings Button (Floating) -->
        <button id="ai-settings-btn" class="ai-settings-btn">ğŸ¤– AI Settings</button>

        <!-- Results Section -->
        <div id="results-section" class="section hidden">
            <div class="results-with-chat-container">
            <div class="results-main-content">
            <h2>Quiz Results</h2>
            <div class="score-summary">
                <div class="score-circle">
                    <span id="score-percentage">0%</span>
                </div>
                <p class="score-text">You scored <span id="score">0</span> out of <span id="total">0</span></p>
            </div>
            
            <h3>Review Your Answers</h3>
            <div id="review-container"></div>
            
            <div class="result-actions">
                <button id="restart-btn" class="btn btn-primary">Take New Quiz</button>
            </div>
            </div>

            <!-- AI Chat Sidebar for Review -->
            <div id="review-chat-sidebar" class="ai-chat-sidebar">
                <div class="chat-header">
                    <h3>ğŸ’¬ Review Helper</h3>
                    <button id="review-chat-toggle-btn" class="chat-toggle-btn">Hide</button>
                </div>
                <div id="review-chat-status" class="chat-status">
                    âš™ï¸ Configure AI in settings to get help
                </div>
                <div id="review-chat-messages" class="chat-messages">
                    <div class="chat-message system">
                        ğŸ‘‹ I can help you understand your mistakes! Click on any incorrect answer to get detailed explanations.
                    </div>
                </div>
                <div class="chat-quick-actions">
                    <button class="review-quick-action-btn" data-action="summary">ğŸ“Š Mistake Summary</button>
                    <button class="review-quick-action-btn" data-action="concepts">ğŸ“š Key Concepts</button>
                    <button class="review-quick-action-btn" data-action="study">ğŸ’¡ Study Tips</button>
                </div>
                <div class="chat-input-area">
                    <div class="chat-input-group">
                        <textarea id="review-chat-input" class="chat-input" placeholder="Ask about your mistakes..." rows="2"></textarea>
                        <button id="review-chat-send-btn" class="chat-send-btn">Send</button>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- MVC Architecture -->
    <script src="ai-helper.js?v=1.1.1"></script>
    <script src="models.js?v=1.0.5"></script>
    <script src="views.js?v=1.0.4"></script>
    <script src="controllers.js?v=1.1.0"></script>
    <script src="app.js?v=1.0.2"></script>
</body>
</html>
